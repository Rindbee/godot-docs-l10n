:github_url: hide

.. DO NOT EDIT THIS FILE!!!
.. Generated automatically from Godot engine sources.
.. Generator: https://github.com/godotengine/godot/tree/master/doc/tools/make_rst.py.
.. XML source: https://github.com/godotengine/godot/tree/master/doc/classes/WorkerThreadPool.xml.

.. _class_WorkerThreadPool:

WorkerThreadPool
================

**ç¹¼æ‰¿ï¼š** :ref:`Object<class_Object>`

å–®ä¾‹ï¼Œå•Ÿå‹•æ™‚æœƒåˆ†é…ä¸€äº› :ref:`Thread<class_Thread>`\ ï¼Œå¯ä»¥å°‡å·¥ä½œè§£é™¤å®‰è£åˆ°é€™äº›åŸ·è¡Œç·’ä¸­åŸ·è¡Œã€‚

.. rst-class:: classref-introduction-group

èªªæ˜
----

**WorkerThreadPool** å–®ä¾‹åœ¨å°ˆæ¡ˆå•Ÿå‹•æ™‚æœƒåˆ†é…ä¸€çµ„ :ref:`Thread<class_Thread>`\ ï¼ˆç¨±ä½œå·¥ä½œåŸ·è¡Œç·’ï¼‰ä¸¦æä¾›å°‡å·¥ä½œè§£é™¤å®‰è£è‡³é€™äº›åŸ·è¡Œç·’ä¸ŠåŸ·è¡Œçš„æ–¹æ³•ã€‚é€™æ¨£å°±èƒ½å¤ ç°¡åŒ–å¤šåŸ·è¡Œç·’çš„ä½¿ç”¨ï¼Œä¸å¿…å»ºç«‹ :ref:`Thread<class_Thread>`\ ã€‚

å·¥ä½œè£¡æ”¾ç½®çš„æ˜¯è¦è®“åŸ·è¡Œç·’åŸ·è¡Œçš„ :ref:`Callable<class_Callable>`\ ã€‚\ **WorkerThreadPool** æ—¢å¯ä»¥å»ºç«‹å¸¸è¦ä»»å‹™ä¹Ÿå¯ä»¥å»ºç«‹ç¾¤çµ„å·¥ä½œï¼Œå¸¸è¦å·¥ä½œç”±å–®å€‹å·¥ä½œåŸ·è¡Œç·’åŸ·è¡Œï¼Œè€Œç¾¤çµ„å·¥ä½œå¯ä»¥åˆ†ä½ˆåœ¨å¤šå€‹å·¥ä½œåŸ·è¡Œç·’åŸ·è¡Œã€‚ç¾¤çµ„å·¥ä½œæœƒå¤šæ¬¡åŸ·è¡ŒåŒä¸€å€‹ :ref:`Callable<class_Callable>`\ ï¼Œå¯ç”¨æ–¼èµ°è¨ªå¤§é‡çš„å…ƒç´ ï¼Œä¾‹å¦‚å ´æ™¯ä¸­çš„æ•µäººã€‚

ä»¥ä¸‹æ˜¯å°‡é–‹éŠ·å¾ˆå¤§çš„å‡½å¼è§£é™¤å®‰è£åˆ°å·¥ä½œåŸ·è¡Œç·’åŸ·è¡Œçš„ä¾‹å­ï¼š


.. tabs::

 .. code-tab:: gdscript

    var enemies = [] # ç”¨æ•µäººå¡«å……çš„é™£åˆ—ã€‚

    func process_enemy_ai(enemy_index):
        var processed_enemy = enemies[enemy_index]
        # é–‹éŠ·å¾ˆå¤§çš„é‚è¼¯â€¦â€¦

    func _process(delta):
        var task_id = WorkerThreadPool.add_group_task(process_enemy_ai, enemies.size())
        # å…¶ä»–ç¨‹å¼ç¢¼â€¦â€¦
        WorkerThreadPool.wait_for_group_task_completion(task_id)
        # è¦æ±‚æ•µäºº AI å·²ç¶“è™•ç†å®Œç•¢çš„å…¶ä»–ç¨‹å¼ç¢¼ã€‚

 .. code-tab:: csharp

    private List<Node> _enemies = new List<Node>(); // ç”¨æ•µäººå¡«å……çš„é™£åˆ—ã€‚

    private void ProcessEnemyAI(int enemyIndex)
    {
        Node processedEnemy = _enemies[enemyIndex];
        // é–‹éŠ·å¾ˆå¤§çš„é‚è¼¯â€¦â€¦
    }

    public override void _Process(double delta)
    {
        long taskId = WorkerThreadPool.AddGroupTask(Callable.From<int>(ProcessEnemyAI), _enemies.Count);
        // å…¶ä»–ç¨‹å¼ç¢¼â€¦â€¦
        WorkerThreadPool.WaitForGroupTaskCompletion(taskId);
        // è¦æ±‚æ•µäºº AI å·²ç¶“è™•ç†å®Œç•¢çš„å…¶ä»–ç¨‹å¼ç¢¼ã€‚
    }



ä»¥ä¸Šç¨‹å¼ç¢¼è¦æ±‚ ``enemies`` é™£åˆ—ä¸­çš„å…ƒç´ å€‹æ•¸åœ¨å¤šåŸ·è¡Œç·’éƒ¨åˆ†åŸ·è¡Œæ™‚ä¿æŒä¸è®Šã€‚

\ **æ³¨æ„ï¼š**\ å¦‚æœåˆ†ä½ˆåˆ°å¤šå€‹åŸ·è¡Œç·’åŸ·è¡Œçš„å·¥ä½œåœ¨è¨ˆç®—æ–¹é¢çš„é–‹éŠ·ä¸¦ä¸å¤§ï¼Œé‚£éº¼ä½¿ç”¨é€™å€‹å–®ä¾‹å¯èƒ½å°æ€§èƒ½æœ‰è² é¢å½±éŸ¿ã€‚

.. rst-class:: classref-introduction-group

æ•™å­¸
----

- :doc:`ä½¿ç”¨å¤šåŸ·è¡Œç·’ <../tutorials/performance/using_multiple_threads>`

- :doc:`åŸ·è¡Œç·’å®‰å…¨çš„ API <../tutorials/performance/thread_safe_apis>`

.. rst-class:: classref-reftable-group

æ–¹æ³•
----

.. table::
   :widths: auto

   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`int<class_int>`                 | :ref:`add_group_task<class_WorkerThreadPool_method_add_group_task>`\ (\ action\: :ref:`Callable<class_Callable>`, elements\: :ref:`int<class_int>`, tasks_needed\: :ref:`int<class_int>` = -1, high_priority\: :ref:`bool<class_bool>` = false, description\: :ref:`String<class_String>` = ""\ ) |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`int<class_int>`                 | :ref:`add_task<class_WorkerThreadPool_method_add_task>`\ (\ action\: :ref:`Callable<class_Callable>`, high_priority\: :ref:`bool<class_bool>` = false, description\: :ref:`String<class_String>` = ""\ )                                                                                          |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`int<class_int>`                 | :ref:`get_caller_group_id<class_WorkerThreadPool_method_get_caller_group_id>`\ (\ ) |const|                                                                                                                                                                                                       |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`int<class_int>`                 | :ref:`get_caller_task_id<class_WorkerThreadPool_method_get_caller_task_id>`\ (\ ) |const|                                                                                                                                                                                                         |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`int<class_int>`                 | :ref:`get_group_processed_element_count<class_WorkerThreadPool_method_get_group_processed_element_count>`\ (\ group_id\: :ref:`int<class_int>`\ ) |const|                                                                                                                                         |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`bool<class_bool>`               | :ref:`is_group_task_completed<class_WorkerThreadPool_method_is_group_task_completed>`\ (\ group_id\: :ref:`int<class_int>`\ ) |const|                                                                                                                                                             |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`bool<class_bool>`               | :ref:`is_task_completed<class_WorkerThreadPool_method_is_task_completed>`\ (\ task_id\: :ref:`int<class_int>`\ ) |const|                                                                                                                                                                          |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | |void|                                | :ref:`wait_for_group_task_completion<class_WorkerThreadPool_method_wait_for_group_task_completion>`\ (\ group_id\: :ref:`int<class_int>`\ )                                                                                                                                                       |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
   | :ref:`Error<enum_@GlobalScope_Error>` | :ref:`wait_for_task_completion<class_WorkerThreadPool_method_wait_for_task_completion>`\ (\ task_id\: :ref:`int<class_int>`\ )                                                                                                                                                                    |
   +---------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

.. rst-class:: classref-section-separator

----

.. rst-class:: classref-descriptions-group

æ–¹æ³•èªªæ˜
--------

.. _class_WorkerThreadPool_method_add_group_task:

.. rst-class:: classref-method

:ref:`int<class_int>` **add_group_task**\ (\ action\: :ref:`Callable<class_Callable>`, elements\: :ref:`int<class_int>`, tasks_needed\: :ref:`int<class_int>` = -1, high_priority\: :ref:`bool<class_bool>` = false, description\: :ref:`String<class_String>` = ""\ ) :ref:`ğŸ”—<class_WorkerThreadPool_method_add_group_task>`

Adds ``action`` as a group task to be executed by the worker threads. The :ref:`Callable<class_Callable>` will be called a number of times based on ``elements``, with the first thread calling it with the value ``0`` as a parameter, and each consecutive execution incrementing this value by 1 until it reaches ``element - 1``.

The number of threads the task is distributed to is defined by ``tasks_needed``, where the default value ``-1`` means it is distributed to all worker threads. ``high_priority`` determines if the task has a high priority or a low priority (default). You can optionally provide a ``description`` to help with debugging.

Returns a group task ID that can be used by other methods.

\ **Warning:** Every task must be waited for completion using :ref:`wait_for_task_completion()<class_WorkerThreadPool_method_wait_for_task_completion>` or :ref:`wait_for_group_task_completion()<class_WorkerThreadPool_method_wait_for_group_task_completion>` at some point so that any allocated resources inside the task can be cleaned up.

.. rst-class:: classref-item-separator

----

.. _class_WorkerThreadPool_method_add_task:

.. rst-class:: classref-method

:ref:`int<class_int>` **add_task**\ (\ action\: :ref:`Callable<class_Callable>`, high_priority\: :ref:`bool<class_bool>` = false, description\: :ref:`String<class_String>` = ""\ ) :ref:`ğŸ”—<class_WorkerThreadPool_method_add_task>`

Adds ``action`` as a task to be executed by a worker thread. ``high_priority`` determines if the task has a high priority or a low priority (default). You can optionally provide a ``description`` to help with debugging.

Returns a task ID that can be used by other methods.

\ **Warning:** Every task must be waited for completion using :ref:`wait_for_task_completion()<class_WorkerThreadPool_method_wait_for_task_completion>` or :ref:`wait_for_group_task_completion()<class_WorkerThreadPool_method_wait_for_group_task_completion>` at some point so that any allocated resources inside the task can be cleaned up.

.. rst-class:: classref-item-separator

----

.. _class_WorkerThreadPool_method_get_caller_group_id:

.. rst-class:: classref-method

:ref:`int<class_int>` **get_caller_group_id**\ (\ ) |const| :ref:`ğŸ”—<class_WorkerThreadPool_method_get_caller_group_id>`

Returns the task group ID of the current thread calling this method, or ``-1`` if invalid or the current thread is not part of a task group.

.. rst-class:: classref-item-separator

----

.. _class_WorkerThreadPool_method_get_caller_task_id:

.. rst-class:: classref-method

:ref:`int<class_int>` **get_caller_task_id**\ (\ ) |const| :ref:`ğŸ”—<class_WorkerThreadPool_method_get_caller_task_id>`

Returns the task ID of the current thread calling this method, or ``-1`` if the task is a group task, invalid or the current thread is not part of the thread pool (e.g. the main thread).

Can be used by a task to get its own task ID, or to determine whether the current code is running inside the worker thread pool.

\ **Note:** Group tasks have their own IDs, so this method will return ``-1`` for group tasks.

.. rst-class:: classref-item-separator

----

.. _class_WorkerThreadPool_method_get_group_processed_element_count:

.. rst-class:: classref-method

:ref:`int<class_int>` **get_group_processed_element_count**\ (\ group_id\: :ref:`int<class_int>`\ ) |const| :ref:`ğŸ”—<class_WorkerThreadPool_method_get_group_processed_element_count>`

è¿”å›å…·æœ‰çµ¦å®š ID çš„ç¾¤çµ„å·¥ä½œçš„ :ref:`Callable<class_Callable>` å·²ç¶“è¢«å·¥ä½œåŸ·è¡Œç·’åŸ·è¡Œçš„æ¬¡æ•¸ã€‚

\ **æ³¨æ„ï¼š**\ åŸ·è¡Œç·’å·²ç¶“é–‹å§‹åŸ·è¡Œ :ref:`Callable<class_Callable>` ä½†å°šæœªå®Œæˆçš„æƒ…æ³ä¸è¨ˆç®—åœ¨å…§ã€‚

.. rst-class:: classref-item-separator

----

.. _class_WorkerThreadPool_method_is_group_task_completed:

.. rst-class:: classref-method

:ref:`bool<class_bool>` **is_group_task_completed**\ (\ group_id\: :ref:`int<class_int>`\ ) |const| :ref:`ğŸ”—<class_WorkerThreadPool_method_is_group_task_completed>`

Returns ``true`` if the group task with the given ID is completed.

\ **Note:** You should only call this method between adding the group task and awaiting its completion.

.. rst-class:: classref-item-separator

----

.. _class_WorkerThreadPool_method_is_task_completed:

.. rst-class:: classref-method

:ref:`bool<class_bool>` **is_task_completed**\ (\ task_id\: :ref:`int<class_int>`\ ) |const| :ref:`ğŸ”—<class_WorkerThreadPool_method_is_task_completed>`

Returns ``true`` if the task with the given ID is completed.

\ **Note:** You should only call this method between adding the task and awaiting its completion.

.. rst-class:: classref-item-separator

----

.. _class_WorkerThreadPool_method_wait_for_group_task_completion:

.. rst-class:: classref-method

|void| **wait_for_group_task_completion**\ (\ group_id\: :ref:`int<class_int>`\ ) :ref:`ğŸ”—<class_WorkerThreadPool_method_wait_for_group_task_completion>`

åœ¨å…·æœ‰çµ¦å®š ID çš„ç¾¤çµ„å·¥ä½œå®Œæˆå‰æš«åœå‘¼å«é€™å€‹æ–¹æ³•çš„åŸ·è¡Œç·’ã€‚

.. rst-class:: classref-item-separator

----

.. _class_WorkerThreadPool_method_wait_for_task_completion:

.. rst-class:: classref-method

:ref:`Error<enum_@GlobalScope_Error>` **wait_for_task_completion**\ (\ task_id\: :ref:`int<class_int>`\ ) :ref:`ğŸ”—<class_WorkerThreadPool_method_wait_for_task_completion>`

Pauses the thread that calls this method until the task with the given ID is completed.

Returns :ref:`@GlobalScope.OK<class_@GlobalScope_constant_OK>` if the task could be successfully awaited.

Returns :ref:`@GlobalScope.ERR_INVALID_PARAMETER<class_@GlobalScope_constant_ERR_INVALID_PARAMETER>` if a task with the passed ID does not exist (maybe because it was already awaited and disposed of).

Returns :ref:`@GlobalScope.ERR_BUSY<class_@GlobalScope_constant_ERR_BUSY>` if the call is made from another running task and, due to task scheduling, there's potential for deadlocking (e.g., the task to await may be at a lower level in the call stack and therefore can't progress). This is an advanced situation that should only matter when some tasks depend on others (in the current implementation, the tricky case is a task trying to wait on an older one).

.. |virtual| replace:: :abbr:`virtual (æœ¬æ–¹æ³•é€šå¸¸éœ€è¦ä½¿ç”¨è€…è¦†å¯«æ‰èƒ½ç”Ÿæ•ˆã€‚)`
.. |required| replace:: :abbr:`required (This method is required to be overridden when extending its base class.)`
.. |const| replace:: :abbr:`const (æœ¬æ–¹æ³•æ²’æœ‰å‰¯ä½œç”¨ã€‚ä¸æœƒä¿®æ”¹è©²å¯¦ä¾‹çš„ä»»ä½•æˆå“¡è®Šæ•¸ã€‚)`
.. |vararg| replace:: :abbr:`vararg (æœ¬æ–¹æ³•é™¤äº†é€™è£¡æè¿°çš„åƒæ•¸å¤–ï¼Œé‚„å¯ä»¥æ¥å—ä»»æ„æ•¸é‡çš„åƒæ•¸ã€‚)`
.. |constructor| replace:: :abbr:`constructor (æœ¬æ–¹æ³•ç”¨æ–¼å»ºæ§‹ä¸€å€‹å‹åˆ¥ã€‚)`
.. |static| replace:: :abbr:`static (æœ¬æ–¹æ³•ç„¡éœ€å¯¦ä¾‹å³å¯å‘¼å«ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨é¡åˆ¥åç¨±å‘¼å«ã€‚)`
.. |operator| replace:: :abbr:`operator (æœ¬æ–¹æ³•æè¿°å°‡æœ¬å‹åˆ¥ä½œç‚ºå·¦é‹ç®—å…ƒæ™‚å¯ç”¨çš„æœ‰æ•ˆé‹ç®—å­ã€‚)`
.. |bitfield| replace:: :abbr:`BitField (æ­¤å€¼æ˜¯ç”±ä¸‹åˆ—æ——æ¨™çµ„æˆçš„ä½å…ƒé®ç½©æ•´æ•¸ã€‚)`
.. |void| replace:: :abbr:`void (ç„¡å›å‚³å€¼ã€‚)`
